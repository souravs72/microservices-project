name: Test GitHub Secrets

on:
  push:
    branches: [main]
  workflow_dispatch: # Allow manual trigger

jobs:
  test-secrets:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Test GitHub Secrets
        env:
          MAIL_USERNAME: ${{ secrets.MAIL_USERNAME }}
          MAIL_PASSWORD: ${{ secrets.MAIL_PASSWORD }}
          JWT_SECRET: ${{ secrets.JWT_SECRET }}
          INTERNAL_API_KEY: ${{ secrets.INTERNAL_API_KEY }}
          REDIS_PASSWORD: ${{ secrets.REDIS_PASSWORD }}
          DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
        run: |
          echo "üîê GitHub Secrets Test"
          echo "===================="
          echo ""
          
          # Test each secret
          secrets_ok=true
          
          echo "üìß Email Configuration:"
          if [ -n "$MAIL_USERNAME" ]; then
            echo "  ‚úÖ MAIL_USERNAME: configured"
          else
            echo "  ‚ùå MAIL_USERNAME: missing"
            secrets_ok=false
          fi
          
          if [ -n "$MAIL_PASSWORD" ]; then
            echo "  ‚úÖ MAIL_PASSWORD: configured"
          else
            echo "  ‚ùå MAIL_PASSWORD: missing"
            secrets_ok=false
          fi
          
          echo ""
          echo "üîë Security Configuration:"
          if [ -n "$JWT_SECRET" ]; then
            echo "  ‚úÖ JWT_SECRET: configured"
          else
            echo "  ‚ùå JWT_SECRET: missing"
            secrets_ok=false
          fi
          
          if [ -n "$INTERNAL_API_KEY" ]; then
            echo "  ‚úÖ INTERNAL_API_KEY: configured"
          else
            echo "  ‚ùå INTERNAL_API_KEY: missing"
            secrets_ok=false
          fi
          
          echo ""
          echo "üóÑÔ∏è Database & Cache:"
          if [ -n "$REDIS_PASSWORD" ]; then
            echo "  ‚úÖ REDIS_PASSWORD: configured"
          else
            echo "  ‚ùå REDIS_PASSWORD: missing"
            secrets_ok=false
          fi
          
          if [ -n "$DB_PASSWORD" ]; then
            echo "  ‚úÖ DB_PASSWORD: configured"
          else
            echo "  ‚ùå DB_PASSWORD: missing"
            secrets_ok=false
          fi
          
          echo ""
          echo "üìã Summary:"
          if [ "$secrets_ok" = true ]; then
            echo "üéâ All GitHub Secrets are properly configured!"
            echo "‚úÖ Your microservices platform is ready for deployment"
          else
            echo "‚ö†Ô∏è  Some secrets are missing or not configured"
            echo "üìù Please add the missing secrets:"
            echo "   1. Go to GitHub repository Settings"
            echo "   2. Navigate to Secrets and variables ‚Üí Actions"
            echo "   3. Add the missing secrets listed above"
            echo "   4. See SETUP_GITHUB_SECRETS.md for detailed instructions"
            exit 1
          fi
